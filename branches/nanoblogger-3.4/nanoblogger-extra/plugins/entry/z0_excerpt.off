# NanoBlogger Plugin to create excerpted version of entry
# cuts content of entry off after "<!--more-->" or 1st blank line

if [ "$NB_EntryFormat" = raw ]; then
	NB_EntryExcerpt=`echo "$NB_EntryBody" |sed -e '1,/<\!--more[^ *].*/!d'`
	excerpt_bool=${NB_EntryExcerpt//*<\!--more*/true}
	if [ "$excerpt_bool" != true ]; then
		# strip markup then grab text up to 1st blank line
		NB_EntryExcerpt=`echo "$NB_EntryBody" |sed -e 's/<[^>]*>//g; 1,/^$/!d'`
	fi
else
	NB_EntryExcerpt=`echo "$NB_EntryBody" |sed -e '1,/<\!--more[^ *].*/!d'`
	excerpt_bool=${NB_EntryExcerpt//*<\!--more*/true}
	if [ "$excerpt_bool" != true ]; then
		# assume markup will be added later
		NB_EntryExcerpt=`echo "$NB_EntryBody" |sed -e '1,/^$/!d'`
	fi
fi
# add link to full entry
NB_EntryExcerptMoreLink='<br /><a href="'${ARCHIVES_PATH}$NB_EntryPermalink'">read more...</a>'
NB_EntryExcerpt="$NB_EntryExcerpt $NB_EntryExcerptMoreLink"
