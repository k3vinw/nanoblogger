<html>
<head>
<title>NanoBlogger Manual</title>
</head>

<body bgcolor="white">

<hr>
<h1>NanoBlogger Manual</h1>
<h2>by <a href="mailto:un1xt3r_at_fastmail_dot_fm">n1xt3r</a> (Kevin Wood)</h2>

<p><hr>
<em>This document explains how to install and use NanoBlogger.</em>
</p><hr>
<p>
<b>Table of Contents</b>
<ul>
<li><a href="#cr1">Introduction</a>
<li><a href="#cr2">Features</a>
<li><a href="#cr3">Installation</a>
<li><a href="#cr4">Requirements</a>
<li><a href="#cr5">Getting Started</a>
<li><a href="#cr6">Settings and Configuration</a>
<li><a href="#cr7">Templates and Placeholders</a>
<li><a href="#cr8">Plugins</a>
<li><a href="#cr9">Publishing Your Blog to a Remote Site</a>
<li><a href="#cr10">Tips and Tricks</a>
<li><a href="#cr11">Credits</a>
</ul>
<p />

<h2><a name="cr1">Introduction</a></h2>
NanoBlogger is a small weblog engine written in Bash for the command line.  It uses common unix tools, such as cat, grep and sed.  It's free to use and modify under the GNU General Public License.<br />
<p />
<b>Synopsis</b>
<blockquote>
	<pre>nb [<u>-b blogdir</u>] [<u>options</u>]</pre>
</blockquote>

<h2><a name="cr2">Features</a></h2>
<ul>
<li>intuitive commandline interface</li>
<li>support for multiple blogs</li>
<li>easy editing and management of entries</li>
<li>archiving by month</li>
<li>category support</li>
<li>permalinks</li>
<li>RSS syndication (comes with RSS 1.0 (RDF) format)</li>
<li>a fully functional web site, using templates and stylesheets for easy customizations</li>
<li>placeholders for easy template manipulation</li>
<li>plugins for calendar, recent entries, blog status, fortunes, etc.</li>
<li>auto-formatting, e.g. line breaks translate to HTML</li>
<li>keeps "clippings" (parts cut out) of the blog for extra portability and modularity (e.g. news.htm, 2003-06.htm)</li>
<li>per-blog configuration via a config file (blog.conf)
<li>no dependency on any javascript, server-side scripting, or server-side includes</li>
<li>no dependency on any external database (uses flat-file)</li>
<li>some small effort at shell portability</li>
</ul>
<p />

<h2><a name="cr3">Installation</a></h2>
<p />
To install nanoblogger, download the tar archive from the web site[1].  Then from the commandline type "tar xzf nanoblogger-XXX.tar.gz where "XXX" equals the version number.<br />
<p><b>Upgrading</b></p>
When upgrading nanoblogger, there's three basic things that need to be considered, and they are: archives, templates, and configuration.  These are the three things that should be backed up and may require some minor adjustments before they work well with the new version.  Here are some steps you can take to help ease the transition.
<ul>
	<li>
		make a g-zipped tar archive of your blog directory: "tar czf oldblog_dir.tar.gz [blog_dir]"
	</li>
	<li>
		rename your blog directory and create a new one using nanoblogger: "nb -b [blog_dir] -a" (skip the configuration)
	</li>
	<li>
		copy the archives directory over to the new blog directory: "cp -r [oldblog_dir]/archives [newblog_dir]"
	</li>
	<li>
		now you can copy blog.conf and your templates back over and rebuild the blog: "nb -b [blog_dir] -u all"
	</li>
</ul>

<h2><a name="cr4">Requirements</a></h2>
<p />
programs required other than bash:
<blockquote>
	cat, cp, cut, dirname, date, expr, grep, mkdir, read, rm, sed, sort, touch, trap
</blockquote>
<p>
For online publishing you'll need some kind of shell or FTP access to your web server.
</p>

<h2><a name="cr5">Getting Started</a></h2>
<b>Creating a New Blog</b>
<blockquote>
	To create a new blog invoke:
	<pre>nb --blogdir myblog_dir --add</pre>
	where "myblog_dir" is a non-existant directory. This is will create a new directory, copy the default files over, and then let you edit the blog's configuration.  Run the same command again to add a new entry.
</blockquote>

<h2><a name="cr6">Settings and Configuration</a></h2>
	To edit the blog's configuration invoke:
	<pre>nb --blogdir myblog_dir --configure</pre>
<b>Setting the Editor</b>
<blockquote>
	The editor defaults to the EDITOR variable in your shell's environment, but falls back on vi when no EDITOR is set.  You can specify a different editor to use by overriding EDITOR in blog.conf or setting the EDITOR variable in your shell's environment.
</blockquote>
<b>Setting the Date Format for New Entries</b>
<blockquote>
	DATE_FORMAT controls the look of a new entry's date.  The default DATE_FORMAT uses "%B %d, %Y %l:%M %p" and  produces something like this: "August 05, 2003 12:53 AM".  You can also specify the locale to be used for date command (see the variable DATE_LOCALE).  Please note that this setting has no effect on previous entries.  Read the man pages of the date command to see more on how to customize the format of the date command's output.
</blockquote>
<b>Setting the Address</b>
<blockquote>
	BLOG_URL is used as the address for the blog.  Typically, you would set this to a remote address such as: "http://myblogurl.com".  If you wish to browse your blog locally you can set this to an address like this: "file:///home/bloguser/blogdir".  Replacing "myblogurl", "bloguser", and "myblogdir" with the actual location of your blog.
</blockquote>
<b>Enabling Full Permalinks</b>
<blockquote>
	FULL_PERMALINKS determines whether permalinks are linked back to the monthly archives or linked to an entry's individual archive.  The default is to leave FULL_PERMALINKS off and link back to the monthly archives.  Enabling FULL_PERMALINKS will increase the time needed to generate your blog.
</blockquote>
<b>Global Configuration</b>
<blockquote>
	NanoBlogger has it's own configuration file, nb.conf that holds settings which effect all blogs.  The global configuration file is read first meaning that settings in the blog's configuration may ovveride settings in nb.conf.  Typically one would set BLOG_DIR here as a default blog directory to use.  NanoBlogger also looks for this file under, $HOME/.nb.conf.
</blockquote>

<h2><a name="cr7">Templates and Placeholders</a></h2>

<blockquote>
	<table border="1" cellspacing="4" cellpadding="2">
	<caption>The blog's appearance is controlled by the following templates:</caption>
	<tr>
	<th align="left">templates</th>
	<th align="left">description</th>
	</tr>
	<tr>
	<td align="left">archive.htm</td>
	<td align="left">controls look of the master archive page</td>
	</tr>
	<tr>
	<td align="left">archive_links.htm</td>
	<td align="left">controls look of the master archive links</td>
	</tr>
	<tr>
	<td align="left">category.htm</td>
	<td align="left">controls look of the categories pages</td>
	</tr>
	<tr>
	<td align="left">category_links.htm</td>
	<td align="left">the links to the categories</td>
	</tr>
	<tr>
	<td align="left">entry.htm</td>
	<td align="left">controls look of your blog entries</td>
	</tr>
	<tr>
	<td align="left">entry_links.htm</td>
	<td align="left">controls look of the entry links</td>
	</tr>
	<tr>
	<td align="left">entrycat_links.htm</td>
	<td align="left">controls look of the entry category links</td>
	</tr>
	<tr>
	<td align="left">main_index.htm</td>
	<td align="left">controls look of the blog's main page</td>
	</tr>
	<tr>
	<td align="left">main_links.htm</td>
	<td align="left">contains user defined links</td>
	</tr>
	<tr>
	<td align="left">makepage.htm</td>
	<td align="left">default template used by makepage option</td>
	</tr>
	<tr>
	<td align="left">month_archive.htm</td>
	<td align="left">controls look of the monthly archive pages</td>
	</tr>
	<tr>
	<td align="left">month_links.htm</td>
	<td align="left">controls look of the monthly archive links</td>
	</tr>
	<tr>
	<td align="left">permalink.htm</td>
	<td align="left">controls look of the permalink pages</td>
	</tr>
	<tr>
	<td align="left">permalink_entry.htm</td>
	<td align="left">controls look of a blog entry within a permalink page</td>
	</tr>
	<tr>
	<td align="left">rdf_catfeed_entry.xml</td>
	<td align="left">controls look of the news items in a category's rss feed</td>
	</tr>
	<tr>
	<td align="left">rdf_catfeed.xml</td>
	<td align="left">controls look and format of a category's rss feed</td>
	</tr>
	<tr>
	<td align="left">rdf_entry.xml</td>
	<td align="left">controls look of the news item in the rss feed</td>
	</tr>
	<tr>
	<td align="left">rdf.xml</td>
	<td align="left">controls look and format of rss feed (index.rdf)</td>
	</tr>
	</table>
</blockquote>

<blockquote>
	<table border="1" cellspacing="4" cellpadding="2">
	<caption>The entry template includes the following placeholders:</caption>
	<tr>
	<th align="left">placeholders</th>
	<th align="left">description</th>
	</tr>
	<tr>
	<td align="left">$NB_EntryAuthor</td>
	<td align="left">author of entry</td>
	</tr>
	<tr>
	<td align="left">$NB_EntryCategories</td>
	<td align="left">entry's category links</td>
	</tr>
	<tr>
	<td align="left">$NB_EntryBody</td>
	<td>entry's content</td>
	</tr>
	<tr>
	<td align="left">$NB_EntryDate</td>
	<td align="left">entry's posted time</td>
	</tr>
	<tr>
	<td align="left">$NB_EntryDescription</td>
	<td align="left">entry's description</td>
	</tr>
	<tr>
	<td align="left">$NB_EntryID</td>
	<td align="left">entry's id</td>
	</tr>
	<tr>
	<td align="left">$NB_EntryPermalink</td>
	<td align="left">entry's permalink</td>
	</tr>
	<tr>
	<td align="left">$NB_EntryTitle</td>
	<td align="left">entry's title</td>
	</tr>
	</table>
	<br />
	<table border="1" cellspacing="4" cellpadding="2">
	<caption>The main template includes the following placeholders:</caption>
	<tr>
	<th align="left">placeholders</th>
	<th align="left">description</th>
	</tr>
	<tr>
	<td align="left">$BLOG_CHARSET</td>
	<td align="left">blog's character set</td>
	</tr>
	<tr>
	<td align="left">$BLOG_CONTACT</td>
	<td align="left">blog's contact info</td>
	</tr>
	<tr>
	<td align="left">$BLOG_DESCRIPTION</td>
	<td align="left">blog's description</td>
	</tr>
	<tr>
	<td align="left">$BLOG_TITLE</td>
	<td align="left">blog's title</td>
	</tr>
	<tr>
	<td align="left">$BLOG_URL</td>
	<td align="left">blog's URL</td>
	</tr>
	<tr>
	<td align="left">$NB_Archive_Links</td>
	<td align="left">links to archives</td>
	</tr>
	<tr>
	<td align="left">$NB_Category_Links</td>
	<td align="left">links to categories</td>
	</tr>
	<tr>
	<td align="left">$NB_Main_Links</td>
	<td align="left">user defined links</td>
	</tr>
	<tr>
	<td align="left">$NB_Entries</td>
	<td align="left">all the current entries</td>
	</tr>
	</table>
</blockquote>

All the placeholders are reinterpreted by the shell as variables when a template is sourced, making the templates capable of a few shell scripting tricks themselves.  As a simple example, you could place this in your template: "Last Modified: `date`", and it would display the time your page was last modified, using the date command.  Thus greatly enhancing the power of the templates, making it possible to create your own script and replace my "Last Modified" example with your own script.<br />
<p />

<p><b>Format of an Entry</b></p>
The entry format is made up of pieces of metadata.  Each piece of metadata is of the format KEY: VALUE, then a carriage return that separates one piece from the next.  The order of the metadata pieces is not important.

<p>Example:</p>
<blockquote>
TITLE: A New Entry<br />
AUTHOR: foo<br />
DATE: January 30 2004, 12:00 PM<br />
DESC: the description of this entry<br />
-----<br />
BODY:<br />
This is my new entry ...<br />
-----<br />
</blockquote>

Entries are kept inside the blog's "archives" directory as time-stamped filenames.  NanoBlogger uses the filename to determine how to sort the entries into the archives.<br />
<p />

<h2><a name="cr8">Plugins</a></h2>
<p />

Plugins typically work by creating placeholders for the templates, but are in no way limited to creating placeholders.  Placeholders allow for a great deal of control in how the plugins output is placed in the template.  The variable, ENABLE_PLUGINS, in blog.conf toggles the use of plugins on/off.  Create plugins that run specifically for your blog by creating a "plugins" directory under a blog's own directory and copying or creating a plugin with the ".sh" extension.
<p />

Additionally there are some plugins specific to the formatting of entries, and are referred to as auto-format plugins, which allows for automatic placement of HTML elements, such as placing paragraph breaks inside blank lines.  The variable, AUTO_FORMAT, in blog.conf toggles this feature on/off, but requires ENABLE_PLUGINS to be toggled on.<br />
<p />

To use a some of the new plugins, you may need to identify it's unique placeholder/destination and add it to your template accordingly.<br />

<blockquote>
	<table border="1" cellspacing="4" cellpadding="2">
	<caption>The plugins included and what placeholders they create (most are enabled by default and setup in the templates):</caption>
	<tr>
	<th align="left">plugins</th>
	<th align="left">description</th>
	<th align="left">placeholders/destination</th>
	<th align="left">special requirements/notes</th>
	</tr>
	<tr>
	<td align="left">archive/monthly_cal.sh</td>
	<td align="left">adds a calendar with links to each monthly archive</td>
	<td align="left">$NB_Monthly_Calendar</td>
	<td align="left">cal</td>
	</tr>
	<tr>
	<td align="left">atom.sh</td>
	<td align="left">adds an atom feed</td>
	<td align="left">$BLOG_URL/atom.xml</td>
	<td align="left">uses templates</td>
	</tr>
	<tr>
	<td align="left">autoformat/auto_break.sh</td>
	<td align="left">adds paragraph breaks to blank lines of entries</td>
	<td align="left">$NB_EntryBody</td>
	<td align="left">none</td>
	</tr>
	<tr>
	<td align="left">autoformat/moods.sh</td>
	<td align="left">adds ability to use mood variables inside a blog's entry</td>
	<td align="left">$NB_EntryBody</td>
	<td align="left">copy moods directory to blog's directory</td>
	</tr>
	<tr>
	<td align="left">blog_status.sh</td>
	<td align="left">generates blog statistics</td>
	<td align="left">$NB_Blog_Status</td>
	<td align="left">none</td>
	</tr>
	<tr>
	<td align="left">calendar.sh</td>
	<td align="left">adds a calendar with links based on the current month</td>
	<td align="left">$NB_Calendar</td>
	<td align="left">cal</td>
	</tr>
	<tr>
	<td align="left">category_links.sh</td>
	<td align="left">adds links to the categories</td>
	<td align="left">$NB_Category_Links</td>
	<td align="left">none</td>
	</tr>
	<tr>
	<td align="left">fortune.sh</td>
	<td align="left">uses fortune to generate random quotes</td>
	<td align="left">$NB_Fortune</td>
	<td align="left">fortune</td>
	</tr>
	<tr>
	<td align="left">list_entries.sh</td>
	<td align="left">adds links to entries recent or old</td>
	<td align="left">$NB_Recent_Entries, $NB_Older_Entries</td>
	<td align="left">none</td>
	</tr>
	<tr>
	<td align="left">master_index.sh</td>
	<td align="left">creates a master index page of the archives</td>
	<td align="left">$BLOG_URL/archives.html</td>
	<td align="left">uses templates</td>
	</tr>
	<tr>
	<td align="left">mymood.sh</td>
	<td align="left">adds ability for user to set a mood status in their blog</td>
	<td align="left">$NB_My_Mood</td>
	<td align="left">copy moods directory to blog's directory</td>
	</tr>
	<tr>
	<td align="left">postformat/tidy.sh</td>
	<td align="left">validates HTML code</td>
	<td align="left">$NB_Tidy</td>
	<td align="left">HTML tidy</td>
	</tr>
	<tr>
	<td align="left">rss.sh</td>
	<td align="left">adds rss feeds</td>
	<td align="left">$BLOG_URL/index.rdf, $BLOG_URL/$ARCHIVES/cat_n.rdf</td>
	<td align="left">uses templates</td>
	</tr>
	</table>
</blockquote>

To disable a plugin, rename the plugin's extension from ".sh" to ".off".  This will move the plugin off of the radar, the next time NanoBlogger is run.<br />
<br />

<h2><a name="cr9">Publishing Your Blog to a Remote Site</a></h2>
<p />

<b>FTP:</b><br />
Any FTP client should do, but I'd recommend ncftp.  Be sure to use recursive mode when uploading your blog directory. e.g. "ftp myblog.com, put -r [your_blog_dir]"
<p />

<b>Other methods:</b><br />
If you're not limited to FTP, you might want to consider SSH (scp, sftp, etc.), rsync or WebDAV.

<h2><a name="cr10">Tips and Tricks</a></h2>
<p />

<ul>
	<li>
		<p>
		Update your blog quickly with the "--update main" option. This option skips the processing of entries and is great for making quick changes to the main page when you don't have any new entries.  e.g. use "nb -u main myblog" to just update the calendar
		</p>
	</li>

	<li>
		<p>
		To add an introduction, create a text file in your blog called, "intro.txt".  Edit the text file to say what you want, then add the following to the main template: 
			<p><pre>cat "$BLOG_DIR"/intro.txt</pre></p> Note the use of left single quotes, they're important.  Also, note that no processing is being done this way, you have to add your own HTML.
		</p>
	</li>
	
	<li>
		<p>
		Remember the "clippings" feature?  Say you already have a web site full of your own custom server-side scripts/includes.  This is where the "news.htm" file comes in.  It contains all the current entries, so adding a news/diary/blog section is just a matter of adding the code to include "news.htm" into the page.  So, now you can have a simple blog-like page, that's updated whenever news.htm changes.
		</p>
	</li>

	<li>
		<p>
		BLOG_PREVIEW_CMD can be used to set a command to run when you want to preview your blog.
		</p>
	</li>

	<li>
		<p>
		BLOG_PUBLISH_CMD can be used to set a command to run when you want to publish your blog.
		</p>
	</li>

	<li>
<p><b>Adding Comment support to Your Blog</b></p>
There's many ways you could accomplish this, but I chose to go with a perl based solution, because most web server's already support it.  The program I found is called CGIComment [2] and was easy to integrate into my blog.  The cool thing about CGIComment is it's ability to append comments to any HTML document.
<p />
Here are the steps to enable comments:
	<ul>
		<li>
			Enable full permalinks in blog.conf. Set FULL_PERMALINKS to "1".
		</li>
		<li>
			Set BLOG_URL_ACTION in blog.conf to "http://myblog.com/cgi-bin/cgicomment.pl?article=".
		</li>
		<li>
			Edit templates/entry.htm, add: &#60;a href="$BLOG_URL_ACTION$PERMALINKS/$permalink_entry"&#62;Comments&#60;/a&#62;
		</li>
		<li>
			Rebuild your blog to reflect the changes. e.g. "nb -b [your_blog_dir] -u all"
		</li>
		<li>
			Unpack CGIComment (e.g. tar xzf CGIComment-1.0.tar.gz) one directory above that of your blog.
		</li>
		<li>
			Edit cgi-bin/cgicomment.conf and set BASE_DIR to "../cgicomment" and ARTICLEDIR to "../[your_blog_dir]".
		</li>
		<li>
			Edit cgi-bin/ccadmin.pl and change the default password.
		</li>
		<li>
			If necessary, recursively upload the "cgi-bin" and "cgicomment" directories one level above your blog directory.
		</li>
		<li>
			Check that "cgicomment" and "cgi-bin" have read &amp; write permissions (e.g. chmod -R 775 cgi-bin cgicomment).
		</li>
		<li>
			Check that "cgicomment.pl" and "ccadmin.pl" are set executable (e.g. chmod 755 ccadmin.pl cgicomment.pl).
		</li>
		<li>
			If necessary, upload your blog directory.
		</li>
	</ul>

	<p>
	When you have comments working you can download my modified set of CGIComment templates[1] that have been designed to integrate with NanoBlogger's default stylesheets.
	</p>

	</li>
</ul>
<p />

<h2><a name="cr11">Credits</a></h2>
<p />
Thanks to Adrien "ze" Urban for many code enhancements and suggestions.<br />
<p />
Thanks to Bowie J. Poag, author of MicroBlogger [3], for the inspiration of this project.<br />
<p />
<a href="http://home.columbus.rr.com/n1xt3r/downloads/">1. http://home.columbus.rr.com/n1xt3r/downloads/</a><br />
<a href="http://triskam.virtualave.net/cgicomment.html">2. http://triskam.virtualave.net/cgicomment.html</a><br />
<a href="http://www.ibiblio.org/propaganda/microblogger">3. http://www.ibiblio.org/propaganda/microblogger</a><br />

</body>
</html>
